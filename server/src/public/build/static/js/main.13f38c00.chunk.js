(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{437:function(e,t,n){},439:function(e,t,n){"use strict";n.r(t);var a=n(8),r=n(0),i=n.n(r),c=n(33),o=n.n(c),s=n(118),u=n(202),l=n(234),d=n(29),p={condition:{page:1,take:10},data:[],isLoading:!1,total:0,totalPage:0};function j(e,t){var n=e.data.filter((function(e){return e.id!==t}));return Object(d.a)(Object(d.a)({},e),{},{data:n,totalPage:Math.ceil((e.total-1)/e.condition.take)})}function f(e,t){return Object(d.a)(Object(d.a)({},e),{},{data:t})}function h(e,t){var n=Object(l.a)(e.data).map((function(e){return e.id===t.id?Object(d.a)(Object(d.a)({},e),t.movie):e}));return Object(d.a)(Object(d.a)({},e),{},{data:n})}function b(e,t){return Object(d.a)(Object(d.a)({},e),{},{condition:Object(d.a)(Object(d.a)({},e.condition),t),totalPage:Math.ceil(e.total/(t.take?t.take:e.condition.take))})}function v(e,t){return Object(d.a)(Object(d.a)({},e),{},{isLoading:t})}function O(e,t){return Object(d.a)(Object(d.a)({},e),{},{total:t,totalPage:Math.ceil(t/e.condition.take)})}function m(e,t){if(!e.data.find((function(e){return e.id===t.id})))return e;var n=Object(d.a)({},e).data.map((function(e){return e.id===t.id&&(e[t.type]=t.value),e}));return Object(d.a)(Object(d.a)({},e),{},{data:n})}var x,y=n(203),g=n.n(y),w=Object(s.c)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"delete_movie":return j(e,t.payload);case"save_movies":return f(e,t.payload);case"edit_movies":return h(e,t.payload);case"set_condition":return b(e,t.payload);case"set_loading":return v(e,t.payload);case"set_total":return O(e,t.payload);case"switch_movie":return m(e,t.payload);default:return e}}),Object(s.a)(u.a,g.a)),k=n(87),C=n(38),I=n(26),M=n.n(I),S=n(41),P=n(65),L=n(66),F=n(83),_=n(80),z=n(444),T=n(239),H=n(447),R=n(121),B=n(449),D=n(448),N=n(44),A=n(443),U=n(446),q=n(450),E=n(97),V=n.n(E),G=function(){function e(){Object(P.a)(this,e)}return Object(L.a)(e,null,[{key:"add",value:function(){var e=Object(S.a)(M.a.mark((function e(t){var n,a;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.a.post("/api/movie",t);case 2:return n=e.sent,a=n.data,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"edit",value:function(){var e=Object(S.a)(M.a.mark((function e(t,n){var a,r;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.a.patch("/api/movie/"+t,n);case 2:return a=e.sent,r=a.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(S.a)(M.a.mark((function e(t){var n,a;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.a.delete("/api/movie/"+t);case 2:return n=e.sent,a=n.data,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=Object(S.a)(M.a.mark((function e(t){var n,a;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.a.get("/api/movie",{params:t});case 2:return n=e.sent,a=n.data,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"findById",value:function(){var e=Object(S.a)(M.a.mark((function e(t){var n,a;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.a.get("/api/movie/"+t);case 2:return n=e.sent,a=n.data,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadPoster",value:function(){var e=Object(S.a)(M.a.mark((function e(t){var n,a;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.a.post("/api/upload",t);case 2:return n=e.sent,a=n.data,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),J=function(e){Object(F.a)(n,e);var t=Object(_.a)(n);function n(){var e;Object(P.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={isPreview:!1},e}return Object(L.a)(n,[{key:"getFileList",value:function(){return this.props.value?[{uid:this.props.value,url:this.props.value,name:this.props.value}]:[]}},{key:"getUploadBtn",value:function(){return this.props.value?null:Object(a.jsxs)("div",{children:[Object(a.jsx)(q.a,{}),Object(a.jsx)("div",{style:{marginTop:8},children:"Upload"})]})}},{key:"handlePreview",value:function(){this.setState(Object(d.a)(Object(d.a)({},this.state),{},{isPreview:!0}))}},{key:"render",value:function(){var e=this;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(A.a,{action:"/api/upload",fileList:this.getFileList(),listType:"picture-card",name:"poster",onPreview:this.handlePreview.bind(this),onRemove:function(){e.props.onChange&&e.props.onChange("")},customRequest:function(){var t=Object(S.a)(M.a.mark((function t(n){var a,r;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(a=new FormData).append(n.filename,n.file),t.next=4,G.uploadPoster(a);case 4:(r=t.sent).err?T.b.error("\u4e0a\u4f20\u5931\u8d25,\u8bf7\u91cd\u8bd5"):e.props.onChange&&e.props.onChange(r.data);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:this.getUploadBtn()}),Object(a.jsx)(U.a,{visible:this.state.isPreview,title:"\u9884\u89c8",footer:null,onCancel:function(){e.setState(Object(d.a)(Object(d.a)({},e.state),{},{isPreview:!1}))},children:Object(a.jsx)("img",{alt:"example",style:{width:"100%"},src:this.props.value})})]})}}]),n}(r.Component),K=n(216),Q=n.n(K),W=function(e){Object(F.a)(n,e);var t=Object(_.a)(n);function n(){var e;Object(P.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).formRef=i.a.createRef(),e}return Object(L.a)(n,[{key:"getFormFieldValue",value:function(e){var t={};for(var n in e)t[n]=e[n];return t}},{key:"componentDidUpdate",value:function(){var e;this.props.movie&&(null===(e=this.formRef.current)||void 0===e||e.setFieldsValue(this.getFormFieldValue(this.props.movie)))}},{key:"render",value:function(){var e=this;return Object(a.jsxs)(z.a,{ref:this.formRef,labelCol:{span:6,offset:0},wrapperCol:{span:18,offset:1},style:{width:400,padding:"2em"},onFinish:function(){var t=Object(S.a)(M.a.mark((function t(n){var a;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.onChange(n);case 2:0===(a=t.sent).length?T.b.success("\u64cd\u4f5c\u6210\u529f",1,(function(){e.props.history.push("/list")})):a.forEach((function(e){T.b.error(e)}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:[Object(a.jsx)(z.a.Item,{label:"\u7535\u5f71\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u7535\u5f71\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a"}],children:Object(a.jsx)(H.a,{})}),Object(a.jsx)(z.a.Item,{label:"\u5c01\u9762",name:"poster",style:{height:104},children:Object(a.jsx)(J,{})}),Object(a.jsx)(z.a.Item,{label:"\u5730\u533a",name:"areas",children:Object(a.jsx)(R.a.Group,{options:["\u4e2d\u56fd\u5927\u9646","\u4e2d\u56fd\u53f0\u6e7e","\u4e2d\u56fd\u9999\u6e2f","\u7f8e\u56fd","\u5370\u5ea6","\u6cf0\u56fd","\u65e5\u97e9"]})}),Object(a.jsx)(z.a.Item,{label:"\u662f\u5426\u7ecf\u5178",name:"isClassic",valuePropName:"checked",children:Object(a.jsx)(B.a,{})}),Object(a.jsx)(z.a.Item,{label:"\u6b63\u5728\u4e0a\u6620",name:"isComing",valuePropName:"checked",children:Object(a.jsx)(B.a,{})}),Object(a.jsx)(z.a.Item,{label:"\u662f\u5426\u70ed\u95e8",name:"isHot",valuePropName:"checked",children:Object(a.jsx)(B.a,{})}),Object(a.jsx)(z.a.Item,{label:"\u65f6\u957f",name:"timeLong",rules:[{required:!0,message:"\u7535\u5f71\u65f6\u957f\u4e0d\u80fd\u4e3a\u7a7a"}],children:Object(a.jsx)(D.a,{min:1,max:999})}),Object(a.jsx)(z.a.Item,{label:"\u7535\u5f71\u7c7b\u578b",name:"types",children:Object(a.jsx)(R.a.Group,{options:["\u559c\u5267","\u620f\u5267","\u52a8\u4f5c","\u7231\u60c5","\u52a8\u6f2b","\u7eaa\u5f55","\u6b66\u6253"]})}),Object(a.jsx)(z.a.Item,{label:"\u63cf\u8ff0",name:"description",children:Object(a.jsx)(Q.a,{rows:4})}),Object(a.jsx)(z.a.Item,{wrapperCol:{span:18,offset:5},children:Object(a.jsx)(N.a,{type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})]})}}]),n}(r.Component),X=Object(C.e)(W),Y=function(){return Object(a.jsx)("div",{children:Object(a.jsx)(X,{onChange:function(){var e=Object(S.a)(M.a.mark((function e(t){var n;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G.add(t);case 2:if(!(n=e.sent).data){e.next=5;break}return e.abrupt("return",[]);case 5:return e.abrupt("return",n.err);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})})},Z=n(445),$=n(442);!function(e){e.isHot="isHot",e.isComing="isComing",e.isClassic="isClassic"}(x||(x={}));var ee=function(e){Object(F.a)(n,e);var t=Object(_.a)(n);function n(){var e;Object(P.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={deleteModel:!1,deleteLoading:!1,deleteMovieId:""},e}return Object(L.a)(n,[{key:"componentDidMount",value:function(){this.props.onLoad&&this.props.onLoad()}},{key:"deleteMovie",value:function(){var e=Object(S.a)(M.a.mark((function e(){return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.onDelete(this.state.deleteMovieId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getColumns",value:function(){var e=this;return[{dataIndex:"poster",title:"\u5c01\u9762",render:function(e){return Object(a.jsx)(Z.a,{width:70,src:e})}},{title:"\u540d\u79f0",dataIndex:"name",ellipsis:!0},{dataIndex:"areas",title:"\u5730\u533a",ellipsis:!0,render:function(e){return e.join(", ")}},{dataIndex:"isClassic",title:"\u662f\u5426\u7ecf\u5178",render:function(t,n){return Object(a.jsx)(B.a,{checked:t,onChange:function(t,a){e.props.onSwitchChange(x.isClassic,t,n.id)}})}},{dataIndex:"isComing",title:"\u6b63\u5728\u4e0a\u6620",render:function(t,n){return Object(a.jsx)(B.a,{checked:t,onChange:function(t){e.props.onSwitchChange(x.isComing,t,n.id)}})}},{dataIndex:"isHot",title:"\u662f\u5426\u70ed\u95e8",render:function(t,n){return Object(a.jsx)(B.a,{checked:t,onChange:function(t){e.props.onSwitchChange(x.isHot,t,n.id)}})}},{dataIndex:"timeLong",title:"\u65f6\u957f",render:function(e){return"".concat(e,"\u5206\u949f")}},{dataIndex:"types",title:"\u7535\u5f71\u7c7b\u578b",ellipsis:!0,render:function(e){return e.join(", ")}},{dataIndex:"description",ellipsis:!0,title:"\u63cf\u8ff0"},{title:"\u64cd\u4f5c",dataIndex:"id",render:function(t){return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(k.b,{to:"/edit/"+t,children:Object(a.jsx)(N.a,{type:"primary",size:"small",style:{fontSize:12,marginRight:10},children:"\u7f16\u8f91"})}),Object(a.jsx)(N.a,{type:"primary",danger:!0,size:"small",style:{fontSize:12},onClick:function(){e.setState(Object(d.a)(Object(d.a)({},e.state),{},{deleteModel:!0,deleteMovieId:t}))},children:"\u5220\u9664"})]})}}]}},{key:"render",value:function(){var e=this;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)($.a,{dataSource:this.props.data,columns:this.getColumns(),loading:this.props.isLoading,sticky:{offsetHeader:0},size:"small",rowKey:"id",pagination:{current:this.props.condition.page,pageSize:this.props.condition.take,total:this.props.total,pageSizeOptions:["2","5","10","20"],showSizeChanger:!0,defaultPageSize:this.props.condition.take,onChange:function(t,n){e.props.onChangePage(t,n)}}}),Object(a.jsx)(U.a,{title:"\u5220\u9664",cancelText:"\u53d6\u6d88\u5220\u9664",okText:"\u786e\u5b9a",okType:"danger",visible:this.state.deleteModel,onOk:Object(S.a)(M.a.mark((function t(){return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState(Object(d.a)(Object(d.a)({},e.state),{},{deleteLoading:!0})),t.next=3,e.deleteMovie();case 3:e.setState(Object(d.a)(Object(d.a)({},e.state),{},{deleteLoading:!1,deleteModel:!1,deleteMovieId:""}));case 4:case"end":return t.stop()}}),t)}))),confirmLoading:this.state.deleteLoading,onCancel:function(){e.setState(Object(d.a)(Object(d.a)({},e.state),{},{deleteModel:!e.state.deleteModel}))},children:Object(a.jsx)("p",{style:{color:"red"},children:"\u786e\u5b9a\u5220\u9664\uff1f"})})]})}}]),n}(i.a.Component),te=n(144),ne=n(117);function ae(e){return{type:"save_movies",payload:e}}function re(e,t){return{type:"edit_movies",payload:{movie:e,id:t}}}function ie(e){return{type:"set_condition",payload:e}}function ce(e){return{type:"set_loading",payload:e}}function oe(e){return{type:"set_total",payload:e}}function se(e){return{type:"delete_movie",payload:e}}var ue={deleteMovie:se,setLoading:ce,setCondition:ie,saveMovie:ae,editMovie:re,setTotal:oe,fetchMovie:function(e){return function(){var t=Object(S.a)(M.a.mark((function t(n,a){var r,i;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n(ce(!0)),n(ie(e)),r=a(),t.next=5,G.find(r.condition);case 5:i=t.sent,n(ae(i.data)),n(oe(i.total)),n(ce(!1));case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},deleteFetchMovie:function(e){return function(){var t=Object(S.a)(M.a.mark((function t(n){return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n(ce(!0)),t.next=3,G.delete(e);case 3:t.sent.data&&n(se(e)),n(ce(!1));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},switchChange:function(e,t,n){return{type:"switch_movie",payload:{type:e,value:t,id:n}}},fetchMovieSwitch:function(e,t,n){return function(){var a=Object(S.a)(M.a.mark((function a(r,i){return M.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return r(ce(!0)),r(re(Object(ne.a)({},e,t),n)),a.next=4,G.edit(n,Object(ne.a)({},e,t));case 4:r(ce(!1));case 5:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}()}};var le=Object(te.b)((function(e){return e}),(function(e){return{onSwitchChange:function(t,n,a){e(ue.fetchMovieSwitch(t,n,a))},onDelete:function(t){return new Promise((function(n){n(e(ue.deleteFetchMovie(t)))}))},onLoad:function(){e(ue.fetchMovie({take:10,page:1}))},onChangePage:function(t,n){e(ue.fetchMovie({page:t,take:n}))}}}))(ee),de=(n(437),n(451)),pe=n(452),je=n(441),fe=n(96),he=n(235),be=Object(C.e)((function(e){var t=Object(r.useState)(),n=Object(he.a)(t,2),i=n[0],c=n[1];return Object(r.useLayoutEffect)((function(){G.findById(e.match.params.id).then((function(e){e.err||c(e.data)}))}),[]),Object(a.jsx)("div",{children:Object(a.jsx)(X,{movie:i,onChange:function(){var t=Object(S.a)(M.a.mark((function t(n){var a;return M.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,G.edit(e.match.params.id,n);case 2:if(!(a=t.sent).data){t.next=5;break}return t.abrupt("return",[]);case 5:return t.abrupt("return",a.err);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})})})),ve=function(e){Object(F.a)(n,e);var t=Object(_.a)(n);function n(){var e;Object(P.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={value:""},e}return Object(L.a)(n,[{key:"render",value:function(){return Object(a.jsx)("h1",{children:"\u6b22\u8fce\u4f7f\u7528"})}}]),n}(r.Component),Oe=je.a.Header,me=je.a.Sider,xe=je.a.Content,ye=function(e){return Object(a.jsx)("div",{className:"container",children:Object(a.jsxs)(je.a,{children:[Object(a.jsx)(Oe,{children:Object(a.jsx)(k.b,{to:"/",children:"\u540e\u53f0\u7ba1\u7406\u7cfb\u7edf"})}),Object(a.jsxs)(je.a,{children:[Object(a.jsx)(me,{children:Object(a.jsxs)(fe.a,{theme:"dark",selectedKeys:e.location.pathname,inlineIndent:30,children:[Object(a.jsx)(fe.a.Item,{icon:Object(a.jsx)(de.a,{}),children:Object(a.jsx)(k.b,{to:"/list",exact:!0,children:"\u7535\u5f71\u5217\u8868"})},"/list"),Object(a.jsx)(fe.a.Item,{icon:Object(a.jsx)(pe.a,{}),children:Object(a.jsx)(k.b,{to:"/add",exact:!0,children:"\u6dfb\u52a0\u7535\u5f71"})},"/add")]})}),Object(a.jsx)(xe,{children:Object(a.jsxs)("div",{className:"content",children:[Object(a.jsx)(C.a,{path:"/",exact:!0,component:ve}),Object(a.jsx)(C.a,{path:"/list",exact:!0,component:le}),Object(a.jsx)(C.a,{path:"/add",exact:!0,component:Y}),Object(a.jsx)(C.a,{path:"/edit/:id",exact:!0,component:be})]})})]})]})})},ge=function(){return Object(a.jsx)(te.a,{store:w,children:Object(a.jsx)(k.a,{children:Object(a.jsx)(C.a,{path:"/",component:ye})})})},we=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,453)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),i(e),c(e)}))};n(438);o.a.render(Object(a.jsx)(i.a.StrictMode,{children:Object(a.jsx)(ge,{})}),document.getElementById("root")),we()}},[[439,1,2]]]);
//# sourceMappingURL=main.13f38c00.chunk.js.map